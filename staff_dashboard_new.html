<!DOCTYPE html>
<html>

<head>
    <base target="_top">
    <?!= include('header') ?>
    <style>
        .modal {
            transition: opacity 0.25s ease;
            z-index: 9999;
            /* Ensure modal has highest z-index */
        }

        body.modal-active {
            overflow-x: hidden;
            overflow-y: visible !important;
        }
    </style>
</head>

<body class="parent">
    <? var url = getUrl(); ?>
    <div id="mainContent">
        <div class="sticky top-0 z-50 ">
            <nav class="p-4 flex flex-wrap justify-between items-center border-b-[1px] "
                style="background-color: rgba(42, 40, 40, 0.2); backdrop-filter: blur(16px);">
                <div class="flex items-center mb-4 md:mb-0 w-full justify-between max-[800px]:mb-0">
                    <a href="<?=url?>?temp=admin_dashboard"><img src="https://i.ibb.co/1dyvwzk/Horizontal-Logo-1.png"
                            alt="EZBOOK Logo" class="h-[60px] object-contain"></a>
                    <div class="flex justify-end items-end">
                        <button onclick="toggleModal('messageModal')" class="cursor-pointer">
                            <svg class="text-white w-10 h-10 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none"
                                viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" />
                            </svg>
                        </button>
                        <button id="profileButton"
                            class="focus:outline-none h-12 w-12 flex items-center justify-center z-50">
                            <img src="https://i.ibb.co/ZBYZbJc/profile-Img.webp" alt="Profile"
                                class="h-12 w-12 rounded-full">
                        </button>
                    </div>
                    <div id="profileMenu" class="dropdown-menu">
                        <a href="<?=url?>?temp=user_profile">User Profile</a>
                        <a href="<?=url?>?temp=user_change_password">Change Password</a>
                        <form id="logoutForm" action="<?= ScriptApp.getService().getUrl() ?>" method="post">
                            <input type="hidden" name="action" value="logout">
                            <button type="submit">Logout</button>
                        </form>
                    </div>
                </div>
                <ul id="navItems"
                    class="flex space-x-10 flex-wrap justify-end flex-grow  -mt-14 w-full max-[800px]:mt-4 max-[426px]:space-x-4 items-center justify-center">
                    <li><a href="<?=url?>?temp=staff_route" class="text-[#f5f5f5] hover:text-lime-500 lg:ml-16">En
                            Route</a>
                    </li>
                    <li><a href="<?=url?>?temp=staff_dashboard" class="text-[#f5f5f5] hover:text-lime-500">Booking</a>
                    </li>
                </ul>
            </nav>
            <div class="h-[74px] bg-[#2a282a] shadow-[8px_4px_4px_10px_#1d1c1d99]">
                <h1 class="text-lime-500 text-2xl pt-5 pl-5">Dashboard</h1>
            </div>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 max-[426px]:m-8 sm:mx-12 sm:my-8 md:mx-24 md:my-16">
            <!-- Details Block -->
            <div class="bg-[#2a282a] p-6 rounded-lg text-[#f5f5f5]">
                <h2 class="text-lime-500 text-xl font-bold mb-4">Details</h2>
                <p>Employee name:</p>
                <p>Employee email:</p>
                <p>Employee contact:</p>
                <p>Zone Assigned:</p>
                <p class="mt-4">Overall Rate: 3.4</p>
                <p>Total Revenue Gain:</p>
                <p>Total Booking Completed this month:</p>
                <p>xxx:</p>
            </div>

            <!-- Feedback Block -->
            <div class="bg-[#2a282a] p-6 rounded-lg">
                <h2 class="text-lime-500 text-xl font-bold mb-4">Feedback <span class="text-xs">Latest</span></h2>
                <select class="px-3 py-1 mb-3 bg-lime-500 text-[#2a282a] rounded-full border-[#2a282a] font-[ABeeZee]">
                    <option value="5">5 Stars</option>
                    <option value="4">4 Stars</option>
                    <option value="3">3 Stars</option>
                    <option value="2">2 Stars</option>
                    <option value="1">1 Star</option>
                </select>
                <!-- <div class="space-y-4 overflow-hidden" id="feedback-loop"> -->
                <div class="overflow-hidden">
                    <div class="flex transition-transform duration-300 ease-in-out w-full" id="feedback-loop">
                        <!-- Feedback 1 -->
                        <div class="border border-gray-200 rounded-lg p-4 space-y-2 w-full">
                            <div class="flex items-center space-x-4">
                                <!-- Profile Image -->
                                <img src="https://i.ibb.co/ZBYZbJc/profile-Img.webp" alt="User Profile"
                                    class="w-10 h-10 rounded-full object-cover">
                                <!-- Name and Service Type -->
                                <div class="flex flex-col flex-1">
                                    <span class="text-[#f5f5f5] font-semibold">Anonymous</span>
                                    <span class="text-gray-400 text-sm">Service Type</span>
                                </div>

                                <!-- Stars and Date/Time Container -->
                                <div class="flex flex-col items-end">
                                    <div class="flex space-x-1">
                                        <!-- Stars -->
                                        <span class="text-lime-500">★</span>
                                        <span class="text-lime-500">★</span>
                                        <span class="text-lime-500">★</span>
                                        <span class="text-lime-500">★</span>
                                        <span class="text-[#f5f5f5]">★</span>
                                    </div>
                                    <!-- Date/Time -->
                                    <span class="text-gray-400 text-sm">Date, Time</span>
                                </div>
                            </div>
                            <div class="bg-[#323232] rounded-md p-3 mt-2">
                                <div class="text-[#f5f5f5]">Feedback content goes here...</div>
                            </div>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-4 space-y-2 w-full">
                            <div class="flex items-center space-x-4">
                                <!-- Profile Image -->
                                <img src="https://i.ibb.co/ZBYZbJc/profile-Img.webp" alt="User Profile"
                                    class="w-10 h-10 rounded-full object-cover">
                                <!-- Name and Service Type -->
                                <div class="flex flex-col flex-1">
                                    <span class="text-[#f5f5f5] font-semibold">Anonymous</span>
                                    <span class="text-gray-400 text-sm">Service Type</span>
                                </div>

                                <!-- Stars and Date/Time Container -->
                                <div class="flex flex-col items-end">
                                    <div class="flex space-x-1">
                                        <!-- Stars -->
                                        <span class="text-lime-500">★</span>
                                        <span class="text-lime-500">★</span>
                                        <span class="text-lime-500">★</span>
                                        <span class="text-lime-500">★</span>
                                        <span class="text-[#f5f5f5]">★</span>
                                    </div>
                                    <!-- Date/Time -->
                                    <span class="text-gray-400 text-sm">Date, Time</span>
                                </div>
                            </div>
                            <div class="bg-[#323232] rounded-md p-3 mt-2">
                                <div class="text-[#f5f5f5]">Feedback content goes here...</div>
                            </div>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-4 space-y-2 w-full">
                            <div class="flex items-center space-x-4">
                                <!-- Profile Image -->
                                <img src="https://i.ibb.co/ZBYZbJc/profile-Img.webp" alt="User Profile"
                                    class="w-10 h-10 rounded-full object-cover">
                                <!-- Name and Service Type -->
                                <div class="flex flex-col flex-1">
                                    <span class="text-[#f5f5f5] font-semibold">Anonymous</span>
                                    <span class="text-gray-400 text-sm">Service Type</span>
                                </div>
                                <!-- Stars and Date/Time Container -->
                                <div class="flex flex-col items-end">
                                    <div class="flex space-x-1">
                                        <!-- Stars -->
                                        <span class="text-lime-500">★</span>
                                        <span class="text-lime-500">★</span>
                                        <span class="text-lime-500">★</span>
                                        <span class="text-lime-500">★</span>
                                        <span class="text-[#f5f5f5]">★</span>
                                    </div>
                                    <!-- Date/Time -->
                                    <span class="text-gray-400 text-sm">Date, Time</span>
                                </div>
                            </div>
                            <div class="bg-[#323232] rounded-md p-3 mt-2">
                                <div class="text-[#f5f5f5]">Feedback content goes here...</div>
                            </div>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-4 space-y-2 w-full">
                            <div class="flex items-center space-x-4">
                                <!-- Profile Image -->
                                <img src="https://i.ibb.co/ZBYZbJc/profile-Img.webp" alt="User Profile"
                                    class="w-10 h-10 rounded-full object-cover">
                                <!-- Name and Service Type -->
                                <div class="flex flex-col flex-1">
                                    <span class="text-[#f5f5f5] font-semibold">Anonymous</span>
                                    <span class="text-gray-400 text-sm">Service Type</span>
                                </div>
                                <!-- Stars and Date/Time Container -->
                                <div class="flex flex-col items-end">
                                    <div class="flex space-x-1">
                                        <!-- Stars -->
                                        <span class="text-lime-500">★</span>
                                        <span class="text-lime-500">★</span>
                                        <span class="text-lime-500">★</span>
                                        <span class="text-[#f5f5f5]">★</span>
                                        <span class="text-[#f5f5f5]">★</span>
                                    </div>
                                    <!-- Date/Time -->
                                    <span class="text-gray-400 text-sm">Date, Time</span>
                                </div>
                            </div>
                            <div class="bg-[#323232] rounded-md p-3 mt-2">
                                <div class="text-[#f5f5f5]">Feedback content goes here...</div>
                            </div>
                        </div>
                    </div>
                    <div class="m-auto text-[#FF4F1A] text-lg" id="no-rating">
                        <div class="flex justify-center items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
                                class="w-6 h-6">
                                <path fill-rule="evenodd"
                                    d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.434c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.434 2.082-5.005Z"
                                    clip-rule="evenodd" />
                            </svg>
                            <p class="ml-2">No rating.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Booking Details Block -->
            <div class="bg-[#2a282a] p-6 rounded-lg sm:col-span-2">
                <h2 class="text-lime-500 text-xl font-bold mb-4">Booking Details <span class="text-xs">Latest</span>
                </h2>
                <div class="overflow-x-auto" id="booking-table">
                    <table class="min-w-full max-w-full rounded-lg text-neutral-100 text-left font-[ABeeZee]">
                        <thead class="text-nowrap">
                            <tr class="border-b-2 border-gray-600">
                                <th class="p-2 md:p-4">Booking ID</th>
                                <th class="p-2 md:p-4">Status</th>
                                <th class="p-2 md:p-4">Customer Name</th>
                                <th class="p-2 md:p-4">Type of Service</th>
                                <th class="p-2 md:p-4">Schedule Date Time</th>
                                <th class="p-2 md:p-4">Start Time</th>
                                <th class="p-2 md:p-4">End Time</th>
                                <th class="p-2 md:p-4">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="hover:bg-gray-700">
                                <td class="p-2 md:p-4 border-b-2 border-gray-600 ">
                                <td class="p-2 md:p-4 border-b-2 border-gray-600 "><span
                                        class="inline-block px-3 py-1 rounded bg-[#FFDB7D] text-black text-[10px] md:text-xs">Pending</span>
                                </td>
                                <td class="p-2 md:p-4 border-b-2 border-gray-600 ">xxx</td>
                                <td class="p-2 md:p-4 border-b-2 border-gray-600 ">xxx</td>
                                <td class="p-2 md:p-4 border-b-2 border-gray-600 ">xxx</td>
                                <td class="p-2 md:p-4 border-b-2 border-gray-600 ">xxx</td>
                                <td class="p-2 md:p-4 border-b-2 border-gray-600 ">xxx</td>
                                <td class="p-2 md:p-4 border-b-2 border-gray-600">
                                    <div class="relative inline-block no-underline"><button
                                            class="bookingButton hover:text-lime-500 focus:text-lime-500"
                                            onclick="toggleDropdown(event, this)"><svg
                                                xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                                stroke-width="1.5" stroke="currentColor" class="size-6">
                                                <path stroke-linecap="round" stroke-linejoin="round"
                                                    d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z" />
                                            </svg></button>
                                        <div
                                            class="dropdown-menu1 absolute right-0 mt-[-0.5rem] hidden bg-[#2a2828] text-neutral-100 rounded-md shadow-lg z-40 text-nowrap border-b border-[#2d3748]">
                                        </div>
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-700">
                                <td class="p-2 md:p-4 border-b-2 border-gray-600 ">
                                <td class="p-2 md:p-4 border-b-2 border-gray-600 "><span
                                        class="inline-block px-3 py-1 rounded bg-[#FFDB7D] text-black text-[10px] md:text-xs">Pending</span>
                                </td>
                                <td class="p-2 md:p-4 border-b-2 border-gray-600 ">xxx</td>
                                <td class="p-2 md:p-4 border-b-2 border-gray-600 ">xxx</td>
                                <td class="p-2 md:p-4 border-b-2 border-gray-600 ">xxx</td>
                                <td class="p-2 md:p-4 border-b-2 border-gray-600 ">xxx</td>
                                <td class="p-2 md:p-4 border-b-2 border-gray-600 ">xxx</td>
                                <td class="p-2 md:p-4 border-b-2 border-gray-600">
                                    <div class="relative inline-block no-underline"><button
                                            class="bookingButton hover:text-lime-500 focus:text-lime-500"
                                            onclick="toggleDropdown(event, this)"><svg
                                                xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                                stroke-width="1.5" stroke="currentColor" class="size-6">
                                                <path stroke-linecap="round" stroke-linejoin="round"
                                                    d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z" />
                                            </svg></button>
                                        <div
                                            class="dropdown-menu1 absolute right-0 mt-[-0.5rem] hidden bg-[#2a2828] text-neutral-100 rounded-md shadow-lg z-40 text-nowrap border-b border-[#2d3748]">
                                        </div>
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-700">
                                <td class="p-2 md:p-4 border-b-2 border-gray-600 ">
                                <td class="p-2 md:p-4 border-b-2 border-gray-600 "><span
                                        class="inline-block px-3 py-1 rounded bg-[#FFDB7D] text-black text-[10px] md:text-xs">Pending</span>
                                </td>
                                <td class="p-2 md:p-4 border-b-2 border-gray-600 ">xxx</td>
                                <td class="p-2 md:p-4 border-b-2 border-gray-600 ">xxx</td>
                                <td class="p-2 md:p-4 border-b-2 border-gray-600 ">xxx</td>
                                <td class="p-2 md:p-4 border-b-2 border-gray-600 ">xxx</td>
                                <td class="p-2 md:p-4 border-b-2 border-gray-600 ">xxx</td>
                                <td class="p-2 md:p-4 border-b-2 border-gray-600">
                                    <div class="relative inline-block no-underline"><button
                                            class="bookingButton hover:text-lime-500 focus:text-lime-500"
                                            onclick="toggleDropdown(event, this)"><svg
                                                xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                                stroke-width="1.5" stroke="currentColor" class="size-6">
                                                <path stroke-linecap="round" stroke-linejoin="round"
                                                    d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z" />
                                            </svg></button>
                                        <div
                                            class="dropdown-menu1 absolute right-0 mt-[-0.5rem] hidden bg-[#2a2828] text-neutral-100 rounded-md shadow-lg z-40 text-nowrap border-b border-[#2d3748]">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div id="messageModal"
        class="desktop-msg overflow-y-auto fixed w-full h-full flex opacity-0 pointer-events-none transition-opacity duration-300 ease-in-out z-[99]">
        <div
            class="mobile-msg modal rounded-lg shadow-lg w-full sm:w-[360px] z-50 bg-[#2a282a] border-lime-500 border-2 rounded-md text-[#f5f5f5] font-[ABeeZee]">
            <div class="modal-header p-4 rounded-t-lg bg-[#2A282A] flex">
                <h2 class="text-lime-500 text-xl">Notification</h2>
                <div class="block min-[426px]:hidden right-4 absolute" onclick="closeModal('messageModal')">&#10006</div>
            </div>
            <div class="px-4 pb-4">
                <div class="flex">
                    <div class="text-lg my-auto" id="msg-add">{Booking ID} is added!</div>
                    <div class="flex flex-col ml-auto text-base">
                        <div>{Date}</div>
                        <div>{Time}</div>
                    </div>
                </div>
                <div class="flex">
                    <div class="text-lg my-auto" id="msg-cancel">{Booking ID} is cancelled!</div>
                    <div class="flex flex-col ml-auto text-base">
                        <div>{Date}</div>
                        <div>{Time}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Function to filter feedbacks based on selected rating
        function filterFeedbacks(selectedRating) {
            const feedbackBlock = document.getElementById('feedback-loop');
            const feedbacks = Array.from(feedbackBlock.children);
            const noRating = document.getElementById('no-rating');
            let hasVisibleFeedback = false;

            // Show or hide feedbacks based on the selected rating
            feedbacks.forEach(feedback => {
                const stars = feedback.querySelectorAll('.text-lime-500');
                if (stars.length === selectedRating) {
                    feedback.style.display = 'block'; // Show feedback
                    hasVisibleFeedback = true;
                } else {
                    feedback.style.display = 'none'; // Hide feedback
                }
            });

            if (hasVisibleFeedback) {
                noRating.style.display = 'none';
            }
            else {
                noRating.style.display = 'block';
            }
        }

        // Function to start the feedback loop
        function startFeedbackLoop() {
            const feedbackBlock = document.getElementById('feedback-loop');
            const feedbacks = Array.from(feedbackBlock.children).filter(feedback => feedback.style.display !== 'none');

            // Only proceed if there are visible feedbacks
            if (feedbacks.length === 0) return;

            const feedbackWidth = feedbacks[0].offsetWidth;
            const marginX = parseFloat(getComputedStyle(feedbacks[0]).marginLeft); // Margin on the left side
            const totalWidth = feedbackWidth + 2 * marginX; // Width of a feedback item plus margins

            function loop() {
                feedbackBlock.style.transition = 'transform 1.5s ease';
                feedbackBlock.style.transform = `translateX(-${totalWidth}px)`;

                setTimeout(() => {
                    feedbackBlock.appendChild(feedbacks[0]); // Move the first element to the end
                    feedbackBlock.style.transition = 'none'; // Disable transition for immediate reset
                    feedbackBlock.style.transform = 'translateX(0)'; // Reset to original position
                    setTimeout(() => {
                        feedbackBlock.style.transition = 'transform 1.5s ease'; // Re-enable transition
                    }, 50);
                }, 1500); // Wait for the transition to complete before moving the first item

                setTimeout(loop, 4000); // Loop every 4 seconds
            }

            loop(); // Start the loop
        }

        // Handle the change event on the select element
        document.querySelector('select').addEventListener('change', (event) => {
            const selectedRating = parseInt(event.target.value, 10);
            filterFeedbacks(selectedRating);
            startFeedbackLoop(); // Restart the loop with filtered feedbacks
        });

        // Initialize with default rating (e.g., 5 stars)
        filterFeedbacks(parseInt(document.querySelector('select').value, 10));
        startFeedbackLoop();

    </script>
    <script>
        // Toggle the dropdown menu - profile
        document.getElementById('profileButton').addEventListener('click', function () {
            var menu = document.getElementById('profileMenu');
            menu.style.display = menu.style.display === 'none' || menu.style.display === '' ? 'block' : 'none';
        });

        // Close the dropdown menu when clicking outside of it
        window.onclick = function (event) {
            if (!event.target.matches('#profileButton') && !event.target.matches('#profileButton img')) {
                var dropdowns = document.getElementsByClassName('dropdown-menu');
                for (var i = 0; i < dropdowns.length; i++) {
                    var openDropdown = dropdowns[i];
                    if (openDropdown.style.display === 'block') {
                        openDropdown.style.display = 'none';
                    }
                }
            }
        }
    </script>
    <script>
        // Load Modal
        function closeModal(modalId){
            const modal = document.getElementById(modalId);
            modal.classList.add('opacity-0', 'pointer-events-none');
            modal.classList.remove('opacity-100');
        }

        function toggleModal(modalId) {
            const modal = document.getElementById(modalId);
            const modalChild = modal.querySelector('.modal');

            if (modal.classList.contains('opacity-0')) {
                modal.classList.remove('opacity-0', 'pointer-events-none');
                modal.classList.add('opacity-100');
            } else {
                modal.classList.add('opacity-0', 'pointer-events-none');
                modal.classList.remove('opacity-100');
            }

            const addBooking = document.getElementById('msg-add');
            const addText = addBooking.textContent || addBooking.innerText;
            if (addText.includes('added')) {
                const addBookingImg = document.createElement('img');
                const existingAddImg = addBooking.parentNode.querySelector('img[alt="booking added"]');
                if (!existingAddImg) {
                    addBookingImg.src = 'https://i.ibb.co/y025Hny/add-booking.png';
                    addBookingImg.alt = 'booking added';
                    addBookingImg.className = 'object-contain mr-3';
                    addBooking.parentNode.insertBefore(addBookingImg, addBooking);
                }
            }

            const cancelBooking = document.getElementById('msg-cancel');
            const cancelText = cancelBooking.textContent || cancelBooking.innerText;
            if (cancelText.includes('cancelled')) {
                const cancelBookingImg = document.createElement('img');
                const existingCancelImg = cancelBooking.parentNode.querySelector('img[alt="booking cancelled"]');
                if (!existingCancelImg) {
                    cancelBookingImg.src = 'https://i.ibb.co/yfPGhqc/cancel-booking.png';
                    cancelBookingImg.alt = 'booking cancelled';
                    cancelBookingImg.className = 'object-contain mr-3';
                    cancelBooking.parentNode.insertBefore(cancelBookingImg, cancelBooking);
                }
            }
        }
    </script>
</body>

</html>